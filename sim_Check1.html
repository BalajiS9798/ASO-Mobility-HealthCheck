<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status | Healthcheck</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
            --accent-green-glow: rgba(34, 197, 94, 0.5);
            --accent-red-glow: rgba(239, 68, 68, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                              radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                              radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            /* === MODIFIED: Changed to row layout === */
            flex-direction: row; 
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
            justify-content: center;
            align-items: flex-start; /* Align to the top of the viewport */
            padding: 2rem;
            gap: 2rem; 
        }

        .dashboard {
            /* === MODIFIED: Set a specific width for side-by-side view === */
            width: 100%;
            max-width: 500px; /* Reduced max-width to fit two cards easily on common screens */
            /* Removed flex-basis and flex-grow to keep them contained */
            
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Ensures they stack on smaller screens */
        @media (max-width: 960px) {
            body {
                flex-direction: column;
                align-items: center;
            }
            .dashboard {
                max-width: 650px;
            }
        }


        header {
            margin-bottom: 2rem;
            text-align: center;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }

        p.subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .status-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .status-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.05);
        }

        .service-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .service-name {
            font-weight: 500;
            font-size: 1rem;
        }

        .service-url {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-family: monospace;
        }

        .signal-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .status-text {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .signal {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: relative;
        }

        /* Status Variants */
        .status-online .signal {
            background-color: var(--accent-green);
            box-shadow: 0 0 12px var(--accent-green-glow);
            animation: pulse-green 2s infinite;
        }
        .status-online .status-text {
            color: var(--accent-green);
        }

        .status-offline .signal {
            background-color: var(--accent-red);
            box-shadow: 0 0 12px var(--accent-red-glow);
        }
        .status-offline .status-text {
            color: var(--accent-red);
        }

        .status-checking .signal {
            background-color: var(--text-secondary);
            animation: blink 1s infinite;
        }
        .status-checking .status-text {
            color: var(--text-secondary);
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

    </style>
</head>
<body>

<div class="dashboard" id="main-dashboard">
    <header>
        <h1>PLAPSMS01E Health</h1>
        <p class="subtitle" id="main-last-updated">Last updated: Never</p>
    </header>

    <div id="main-app-list" class="status-list">
        </div>
</div>

<div class="dashboard" id="secondary-dashboard">
    <header>
        <h1>PLAPSMS02E Health</h1>
        <p class="subtitle" id="secondary-last-updated">Last updated: Never</p>
    </header>

    <div id="secondary-app-list" class="status-list">
        </div>
</div>


<script>
    // --- CONFIGURATION ---
    
    // ** List 1: Core Services **
    const mainServices = [

{ name: 'Server1SimMobile1', url: 'http://plapsms01e:9020/healthcheck' },
{ name: 'Server1SimMobile2', url: 'http://plapsms01e:9022/healthcheck' },
{ name: 'Server1SimMobile3', url: 'http://plapsms01e:9024/healthcheck' },
{ name: 'Server1SimMobile4', url: 'http://plapsms01e:9026/healthcheck' },
{ name: 'Server1SimApi1', url: 'http://plapsms01e:8020/healthcheck' },
{ name: 'Server1SimApi2', url: 'http://plapsms01e:8022/healthcheck' },
{ name: 'Server1SimApi3', url: 'http://plapsms01e:8024/healthcheck' },
{ name: 'Server1SimApi4', url: 'http://plapsms01e:8026/healthcheck' }

    ];

    // ** List 2: External Endpoints **
    const secondaryServices = [

{ name: 'Server1SimMobile1', url: 'http://plapsms02e:9020/healthcheck' },
{ name: 'Server1SimMobile2', url: 'http://plapsms02e:9022/healthcheck' },
{ name: 'Server1SimMobile3', url: 'http://plapsms02e:9024/healthcheck' },
{ name: 'Server1SimMobile4', url: 'http://plapsms02e:9026/healthcheck' },
{ name: 'Server2SimApi1', url: 'http://plapsms02e:8020/healthcheck' },
{ name: 'Server2SimApi2', url: 'http://plapsms02e:8022/healthcheck' },
{ name: 'Server2SimApi3', url: 'http://plapsms02e:8024/healthcheck' },
{ name: 'Server2SimApi4', url: 'http://plapsms02e:8026/healthcheck' }

    ];

    // --- DOM Elements ---
    const mainAppListEl = document.getElementById('main-app-list');
    const mainLastUpdatedEl = document.getElementById('main-last-updated');
    const secondaryAppListEl = document.getElementById('secondary-app-list');
    const secondaryLastUpdatedEl = document.getElementById('secondary-last-updated');


    // --- Core Functions (Refactored to be reusable) ---

    function createStatusItem(service, prefix) {
        const div = document.createElement('div');
        div.className = 'status-item status-checking';
        // Use a prefix to ensure unique IDs across both lists
        div.id = `${prefix}-${service.name.replace(/\s/g, '-')}`; 
        div.innerHTML = `
            <div class="service-info">
                <span class="service-name">${service.name}</span>
                <span class="service-url">${service.url}</span>
            </div>
            <div class="signal-container">
                <span class="status-text">Checking...</span>
                <div class="signal"></div>
            </div>
        `;
        return div;
    }

    function updateStatus(itemId, isOnline) {
        const item = document.getElementById(itemId);
        if (!item) return;

        // Remove old classes
        item.classList.remove('status-checking', 'status-online', 'status-offline');
        
        // Add new class
        if (isOnline) {
            item.classList.add('status-online');
            item.querySelector('.status-text').textContent = 'Operational';
        } else {
            item.classList.add('status-offline');
            item.querySelector('.status-text').textContent = 'Unreachable';
        }
    }

    async function checkService(service, prefix) {
        const itemId = `${prefix}-${service.name.replace(/\s/g, '-')}`;
        
        try {
            // Using no-cors to check connectivity, not strict 200 OK content
            await fetch(service.url, { mode: 'no-cors', cache: 'no-store' });
            updateStatus(itemId, true);
        } catch (error) {
            console.warn(`Failed to reach ${service.url}`, error);
            updateStatus(itemId, false);
        }
    }

    // --- Health Check Runner ---

    async function runHealthChecks(services, appListEl, lastUpdatedEl, prefix) {
        const now = new Date();
        lastUpdatedEl.textContent = `Last updated: ${now.toLocaleTimeString()}`;

        // Ensure the list is cleared and populated only once at initialization
        // For re-runs, we rely on the existing elements
        if (appListEl.children.length === 0) {
            services.forEach((service) => {
                const el = createStatusItem(service, prefix);
                appListEl.appendChild(el);
            });
        }

        services.forEach((service) => {
            // Note: We don't re-create the element, just re-run the check
            // and update the status via its unique ID.
            checkService(service, prefix); 
        });
    }

    // --- Initialization ---

    function init() {
        // Run checks for the main services
        runHealthChecks(mainServices, mainAppListEl, mainLastUpdatedEl, 'main');
        
        // Run checks for the secondary services
        runHealthChecks(secondaryServices, secondaryAppListEl, secondaryLastUpdatedEl, 'secondary');

        // Auto-refresh for both lists every 30 seconds
        setInterval(() => {
            runHealthChecks(mainServices, mainAppListEl, mainLastUpdatedEl, 'main');
            runHealthChecks(secondaryServices, secondaryAppListEl, secondaryLastUpdatedEl, 'secondary');
        }, 30000);
    }

    init();

</script>

</body>
</html>
